function BWIPJS(t,s){if(this.constructor!==BWIPJS)return new BWIPJS(t,s);this.bmap=null,this.gstk=[],this.reset(),this.ft={monochrome:t.cwrap("monochrome","number",["number"]),lookup:t.cwrap("find_font","number",["string"]),bitmap:t.cwrap("get_bitmap","number",["number","number","number","number"]),width:t.cwrap("get_width","number",[]),height:t.cwrap("get_height","number",[]),left:t.cwrap("get_left","number",[]),top:t.cwrap("get_top","number",[]),advance:t.cwrap("get_advance","number",[]),module:t},this.ft.monochrome(s?1:0)}BWIPJS.prototype.bitmap=function(t){return t&&(this.bmap=t),this.bmap},BWIPJS.prototype.reset=function(){this.g_tdx=0,this.g_tdy=0,this.g_tsx=1,this.g_tsy=1,this.g_posx=0,this.g_posy=0,this.g_penw=1,this.g_path=[],this.g_font=null,this.g_rgb=[0,0,0]},BWIPJS.prototype.save=function(){function t(s){if(s instanceof Array){for(var h=[],i=0;i<s.length;i++)h[i]=t(s[i]);return h}if(s instanceof Object){h={};for(var o in s)h[o]=t(s[o]);return h}return s}var s={};for(var h in this)0==h.indexOf("g_")&&(s[h]=t(this[h]));this.gstk.push(s)},BWIPJS.prototype.restore=function(){if(!this.gstk.length)throw new Error("grestore: stack underflow");var t=this.gstk.pop();for(var s in t)this[s]=t[s];this.bmap&&this.bmap.color(this.g_rgb[0],this.g_rgb[1],this.g_rgb[2])},BWIPJS.prototype.currpos=function(){return{x:(this.g_posx-this.g_tdx)/this.g_tsx,y:(this.g_posy-this.g_tdy)/this.g_tsy}},BWIPJS.prototype.currfont=function(){return this.g_font},BWIPJS.prototype.findfont=function(t){return{FontName:t}},BWIPJS.prototype.translate=function(t,s){this.g_tdx=this.g_tsx*t,this.g_tdy=this.g_tsy*s},BWIPJS.prototype.scale=function(t,s){this.g_tsx*=t,this.g_tsy*=s},BWIPJS.prototype.setlinewidth=function(t){this.g_penw=t},BWIPJS.prototype.setfont=function(t){this.g_font=t},BWIPJS.prototype.getfont=function(){return this.ft.lookup(this.g_font.FontName.toString())},BWIPJS.prototype.setcolor=function(t){if(6==t.length)var s=parseInt(t.substr(0,2),16),h=parseInt(t.substr(2,2),16),i=parseInt(t.substr(4,2),16);else{if(8!=t.length)throw"bwipp.setcolor: invalid string length ("+t+")";var o=parseInt(t.substr(0,2),16)/255,r=parseInt(t.substr(2,2),16)/255,e=parseInt(t.substr(4,2),16)/255,n=parseInt(t.substr(6,2),16)/255,s=Math.round((1-o)*(1-n)*255),h=Math.round((1-r)*(1-n)*255),i=Math.round((1-e)*(1-n)*255)}this.bmap.color(s,h,i),this.g_rgb=[s,h,i]},BWIPJS.prototype.newpath=function(){this.g_path=[]},BWIPJS.prototype.closepath=function(){if(this.g_path.length){var t=this.g_path[0],s=this.g_path[this.g_path.length-1];this.g_path.push([s[0],s[1]]),this.g_path.push(["c"]),this.g_path.push([t[0],t[1]])}},BWIPJS.prototype.moveto=function(t,s){this.g_posx=this.g_tdx+this.g_tsx*t,this.g_posy=this.g_tdy+this.g_tsy*s},BWIPJS.prototype.rmoveto=function(t,s){this.g_posx+=this.g_tsx*t,this.g_posy+=this.g_tsy*s},BWIPJS.prototype.lineto=function(t,s){this.g_path.push([this.g_posx,this.g_posy]),this.g_path.push(["l"]),this.g_posx=this.g_tdx+this.g_tsx*t,this.g_posy=this.g_tdy+this.g_tsy*s,this.g_path.push([this.g_posx,this.g_posy])},BWIPJS.prototype.rlineto=function(t,s){this.g_path.push([this.g_posx,this.g_posy]),this.g_path.push(["l"]),this.g_posx+=this.g_tsx*t,this.g_posy+=this.g_tsy*s,this.g_path.push([this.g_posx,this.g_posy])},BWIPJS.prototype.stringwidth=function(t){for(var s=this.getfont(),h=+this.g_font.FontSize||10,i="string"==typeof t,o=0,r=0,e=0,n=0;n<t.length;n++){var a=i?t.charCodeAt(n):t[n],p=this.ft.bitmap(s,a,h*this.g_tsx,h*this.g_tsy);if(o+=this.ft.advance(),p){var g=this.ft.height(),_=this.ft.top();r=Math.max(r,_),e=Math.max(e,g-_)}}return{w:o/this.g_tsx,h:(r+e)/this.g_tsy,a:r/this.g_tsy,d:e/this.g_tsy}},BWIPJS.prototype.charpath=function(t,s){var h=this.stringwidth(t);this.rlineto(0,h.a),this.rlineto(h.w,0),this.rlineto(0,-h.h)},BWIPJS.prototype.pathbbox=function(){if(!this.g_path.length)throw new Error("pathbbox: --nocurrentpoint--");for(var t=this.g_path,s=t[0][0],h=t[0][1],i=0,o=0,r=2,e=2;r<t.length;r+=e)s>t[r][0]&&(s=t[r][0]),i<t[r][0]&&(i=t[r][0]),h>t[r][1]&&(h=t[r][1]),o<t[r][1]&&(o=t[r][1]),e=2==e?1:2;return{llx:(s-this.g_tdx)/this.g_tsx,lly:(h-this.g_tdy)/this.g_tsy,urx:(i-this.g_tdx)/this.g_tsx,ury:(o-this.g_tdy)/this.g_tsy}},BWIPJS.prototype.stroke=function(){void 0===this.__miny&&(this.__miny=1/0);var t=this.g_penw*this.g_tsx,s=this.g_penw*this.g_tsy,h=this.g_path.length/3;"c"==this.g_path[this.g_path.length-2][0]&&h--;for(var i=0;i<this.g_path.length;){var o=this.g_path[i++],r=this.g_path[i++],e=this.g_path[i++];switch(this.__miny>o[1]&&(this.__miny=o[1]),this.__miny>e[1]&&(this.__miny=e[1]),r[0]){case"l":this.drawline(!0,o[0],o[1],e[0],e[1],t,s,h>1);break;case"c":break;default:throw new Error("stroke: undefined opcode: "+r[0])}}this.g_path=[]},BWIPJS.prototype.floorscale=function(){this.g_tsx=Math.floor(this.g_tsx)||1,this.g_tsy=Math.floor(this.g_tsy)||1},BWIPJS.prototype.ceilscale=function(){this.g_tsx=Math.ceil(this.g_tsx)||1,this.g_tsy=Math.ceil(this.g_tsy)||1},BWIPJS.prototype.roundscale=function(){this.g_tsx=Math.round(this.g_tsx)||1,this.g_tsy=Math.round(this.g_tsy)||1},BWIPJS.prototype.setextent=function(){if(this.g_path.length){for(var t=this.g_path,s=t[0][0],h=t[0][1],i=0,o=0,r=2,e=2;r<t.length;r+=e)s>t[r][0]&&(s=t[r][0]),i<t[r][0]&&(i=t[r][0]),h>t[r][1]&&(h=t[r][1]),o<t[r][1]&&(o=t[r][1]),e=2==e?1:2;this.bmap.extent(s,h,i,o)}},BWIPJS.prototype.imagemask=function(t,s,h){var i,o=Math.round(this.g_tsx),r=Math.round(this.g_tsy),e=Math.floor(o/t),n=Math.floor(r/s),a=Math.ceil(t/8),p=Math.floor(this.g_tdy)+s*n;if(!e||!n)throw new Error("Image scaled to zero size.");for(var g=0;g<s;g++){i=Math.floor(this.g_tdx),p-=n;for(var _=0;_<t;_++){if(h[g*a+(_>>>3)]&1<<7-(7&_))for(var f=i+e,u=p+n,l=p;l<u;l++)for(var y=i;y<f;y++)this.bmap.set(y,l,255);i+=e}}},BWIPJS.prototype.show=function(t,s,h){var i=this.getfont(),o=+this.g_font.FontSize||10,r="string"==typeof t;s=this.g_tsx*s,h=this.g_tsy*h;for(var e=0;e<t.length;e++){var n=r?t.charCodeAt(e):t[e],a=this.ft.bitmap(i,n,o*this.g_tsx,o*this.g_tsy);if(a){var p=this.g_posx+this.ft.left();i<=1&&n>=48&&n<=57&&(p-=.5*this.g_tsx);for(var g,_=this.g_posy+this.ft.top()+h,f=this.ft.width(),u=this.ft.height(),l=this.ft.module.HEAPU8.subarray(a,a+f*u),y=0;y<f;y++)for(var c=0;c<u;c++)(g=l[c*f+y])&&this.bmap.set(p+y,_-c,g);this.g_posx+=this.ft.advance()+s}else this.g_posx+=this.ft.advance()+s}},BWIPJS.prototype.drawline=function(t,s,h,i,o,r,e,n){if(!t||s!=i&&h!=o){s=Math.floor(s),i=Math.floor(i),h=Math.floor(h),o=Math.floor(o);var a=Math.abs(i-s),p=Math.abs(o-h),g=i<s?-1:1,_=o<h?-1:1,f=s,u=h,l=0,y=Math.floor(Math.sqrt(r*r+e*e)),c=Math.round(Math.sqrt(y*y/(p*p/(a*a)+1)))||1,d=Math.round(Math.sqrt(y*y-c*c))||1;if(a>=p){for(;f!=i;){for(m=0;m<c;m++)this.bmap.set(f,u+m,255);(l+=p)>=a&&(l-=a,u+=_),f+=g}for(m=0;m<c;m++)this.bmap.set(f,u+m,255)}else{for(;u!=o;){for(m=0;m<d;m++)this.bmap.set(f+m,u,255);(l+=a)>=p&&(l-=p,f+=g),u+=_}for(var m=0;m<d;m++)this.bmap.set(f+m,u,255)}}else{var b=Math.round(r),x=Math.round(e);if(o<h){v=h;h=o,o=v}if(i<s){var v=s;s=i,i=v}s==i?(s=Math.floor(s-b/2),i=Math.floor(i+b/2),h=Math.floor(h-(n?x/2:0)),o=Math.floor(o+(n?x/2:0))):(h=Math.floor(h-x/2),o=Math.floor(o+x/2),s=Math.floor(s-(n?b/2:0)),i=Math.floor(i+(n?b/2:0)));for(u=h;u<o;u++)for(f=s;f<i;f++)this.bmap.set(f,u,255)}},"object"==typeof module&&module.exports&&(module.exports=BWIPJS);